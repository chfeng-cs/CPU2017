<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Building Tools - CPU 2017</title>
<!-- You'll want a nice wide screen when editing this .......................................................................... -->

<link rel="STYLESHEET" href="css/cpudocs.css" type="text/css" />
<link rel="STYLESHEET" href="css/cpudocsNoLinkie.css" media="print" type="text/css" />
<style type="text/css">
body { background: white; color: black; }
</style>

</head>
<body>

<h1 style="margin-bottom:0">Building the SPEC CPU&reg;2017 Toolset</h1>
<table class="version">
   <tr>
      <th>$Id: tools-build.html 6311 2019-07-28 22:11:16Z JohnHenning $</th>
      <td>Latest: <a class="external" href="https://www.spec.org/cpu2017/Docs/">www.spec.org/cpu2017/Docs/</a></td>
   </tr>
</table>


<p class="contents">Contents</p>

<p class="contentsl1"><a href="#intro">          1. </a>Introduction</p>
<p class="contentsl2"><a href="#what">              a. </a>What are the tools?</p>
<p class="contentsl2"><a href="#precompiled">       b. </a>Pre-compiled binaries</p>
<p class="contentsl2"><a href="#when2build">        c. </a>When to build the tools yourself</p>
<p class="contentsl2"><a href="#logit">             d. </a>Turn on session recorder</p>
<p class="contentsl1"><a href="#how">            2. </a>How to build the tools</p>
<p class="contentsl2"><a href="#unix">              a. </a>Notes specific to Unix systems</p>
<p class="contentsl2"><a href="#windows">           b. </a>Notes specific to Windows systems</p>
<p class="contentsl1"><a href="#verify">         3. </a>How to verify that your build succeeded</p>
<p class="contentsl1"><a href="#describe">       4. </a>Describing your newly-built tools</p>
<p class="contentsl2"><a href="#presentation">      a. </a>Toolset presentation</p>
<p class="contentsl3"><a href="#exclusion">           1. </a>Excluding otherwise valid candidates</p>
<p class="contentsl3"><a href="#order">               2. </a>Affecting presentation order</p>
<p class="contentsl1"><a href="#package">        5. </a>Packagetools</p>
<p class="contentsl2"><a href="#PackageExample">    a. </a> Example: use packagetools</p>
<p class="contentsl2"><a href="#PackageTestExample"> b.</a> Example: test the newly packaged tools </p>
<p class="contentsl1"><a href="#troubleshooting">6. </a>Troubleshooting: What to do if something goes wrong</p>
<p class="contentsl2"><a href="#hand">             a. </a>Try it by hand</p>
<p class="contentsl2"><a href="#known">            b. </a>Known problems</p>
<p class="contentsl2"><a href="#justpart">         c. </a>Executing just part of buildtools</p>
<p class="contentsl1last"><a href="#support">     7.</a>Support</p>

<h2 id="intro">1. Introduction</h2>

<p>This document describes how to build the SPEC CPU&reg;2017 tool set.  SPEC CPU 2017 is 
a product of the SPEC&reg; non-profit corporation <a href="https://www.spec.org/spec/" class="external">(about SPEC)</a>.  
SPEC supplies various tools that are used to ensure consistent operation of benchmarks across a variety of platforms.  In
order to generate a valid result which can be used in public and/or submitted to SPEC, you must use the SPEC supplied tools.
</p>

<p>The tools are supplied with your copy of SPEC CPU 2017, in both source form and binary form.  Usually, the binaries will be
all that you need (and you won't need this document).</p>

<h3 id="what">1.a. What are the tools?</h3>

<p>The SPEC CPU 2017 tools include (but are not limited to):</p>

  <table class="l1">
     <tr>
        <th><a href="utility.html#rawformat" class="external">rawformat</a></th>
        <td>Report writer for all SPEC CPU 2017 resuls</td>
     </tr>
     <tr>
        <th><a href="runcpu.html" class="external">runcpu</a></th>
        <td>The primary user interface for running the benchmarks. </td>
     </tr>
     <tr> <th><a href="utility.html#specdiff" class="external">specdiff</a></th>
        <td>Examines benchmark outputs for acceptable answers.</td>
     </tr>
     <tr>
        <th><a href="utility.html#sysinfo" class="external">sysinfo</a></th>
        <td>Inventories various aspects of a System Under Test</td>
     </tr>
     <tr> 
        <th><a href="utility.html#specinvoke" class="external">specinvoke</a> </th>
        <td> Runs and times commands, after <samp>runcpu</samp> sets them up.</td>
     </tr>
     <tr><td colspan="2">(Some of the above are Perl scripts, which are always used in source form; some need to be compiled.)</td></tr>
  </table>

  <p><b>Redistributable tools.</b> SPEC gratefully acknowledges the many free and open source software contributions that are
  used in CPU 2017.  The table below provides a few examples; for the complete list, please see 
  <a href="licenses.html#free" class="external">SPEC CPU 2017 Licenses</a>.  
  Most are built as <samp>spec<i>toolname</i></samp> to avoid possible conflicts
  with versions that may may already be on your system.  SPEC requires that published results use the versions of
  the tools that it supplies, to improve benchmark result comparability.</p>

  <table class="l1">
  <tr> 
     <th><a class="external" href="utility.html#specmake">specmake</a>    </th> 
     <td> GNU <samp>make</samp></td>
     <td>Builds binary versions of benchmark source files.</td>
  </tr>
  <tr> 
     <th><a class="external" href="utility.html#specxz">specxz</a>      </th>
     <td>XZ Utils</td>
     <td> Compression      </td>
  </tr>
  <tr> 
     <th><a class="external" href="utility.html#specsha512sum">specsha512sum</a>  </th>
     <td>From GNU coreutils</td>
     <td>Print or verify checksums. </td>
  </tr>
  <tr> 
     <th><a class="external" href="utility.html#spectar">spectar</a>     </th>
     <td>GNU <samp>tar</samp></td>
     <td>Save or restore from file archives</td>
  </tr>
  <tr> 
     <th><a class="external" href="utility.html#specperl">specperl</a>    </th>
     <td>Perl </td>
     <td>The Perl 5 language interpreter</td>
  </tr>
     <tr>
        <td colspan="3">And <a href="licenses.html#free" class="external">many more</a>.  </td>
     </tr>
  </table>


<h3 id="precompiled">1.b. Pre-compiled binaries</h3>

<p>You will find pre-compiled binaries for the tools on your distribuion media, in the directories:</p>

<pre class="l1">tools/bin/&lt;archname&gt; <span class="body">(Unix)</span>
tools\bin\&lt;archname&gt; <span class="body">(Microsoft Windows)</span></pre>

<p>After installation, the above directory will be found underneath <samp>$SPEC</samp> (Unix) or %SPEC% (Windows).</p>

<p>The appropriate set of precompiled binaries is automatically installed when you run
    <samp class="nb">install.sh</samp>  (Unix) or 
    <samp class="nb">install.bat</samp> (Windows).</p>


<h3 id="when2build">1.c. When to build the tools yourself</h3>

<p>Sometimes it may be necessary to rebuild the tools, for example if a change in an operating system renders a precompiled
binary inoperable, or if you are the first person to add support for a new architecture.</p>

<p>It is generally not possible to do cross-compilation of Perl, as Perl's build process involves running binaries generated
during the build.  Therefore, getting a toolset onto an embedded platform without a native compiler is most likely impossible.</p>

<h3 id="logit">1.d. Turn on session recorder</h3>


<p class="snugbot">Please <span class="alarm"><b>turn on your operating system's session
recorder</b></span> (e.g. in Unix, typically the <samp class="nb">script(1)</samp> command) prior to using
<samp class="snugr">buildtools</samp>.  If you do not have a session recorder, make your terminal window 999999 lines tall and be prepared to
cut-and-paste the full output.  There are two reasons to record your session:</p>
<ol>
   <li>In case something goes wrong, and you want to ask SPEC for technical support.</li>
   <li>If case everything goes right, and you want to use your results in public.</li>
</ol>

<div class="l2" style="width:600px;border:thin solid gray;padding:5px;">
<p class="snug" ><span class="alarm"><b>NOTICE: </b></span>If you want to generate results that can be used in public, you must
ask SPEC to review your tool build prior to publishing (whether <a href="https://www.spec.org/cpu2017/results/"
class="external">at SPEC</a> or elsewhere.)   You will need to provide the log and the output from <samp class="nb">runcpu
-V</samp> and <samp class="nb">runcpu --test</samp> on a system OTHER than the build system, where you have installed
your new tools build.</p>
</div>


<h2 id="how">2. How to build the tools</h2>

<p>If the directory <samp class="nb">$SPEC/tools/src</samp> (Unix) or <samp class="nb">%SPEC%\tools\src</samp> (Windows) does
not yet exist, look in the directory <samp>install_archives</samp> on your SPEC CPU 2017 distribution media, for a file with a
name similar to <samp class="nbsnugr">tools-src.tar</samp>. (The name might vary slightly, depending on your version of
CPU 2017.) Expand it into a writable directory local to the build system.  (Building tools on networked filesystems might
work, but it may make some of GNU tar's tests fail, so it's safer to build on a local filesystem.)  </p>

<p>In the example below, the user notes that the tools source directory is not present, locates the tar file on the
distribution media, unpacks it, and then lists the contents of the newly-unpacked <samp class="snugr">tools/src</samp>.
(Note: the set of directories, and the versions of the tools, may vary depending on your version of SPEC CPU 2017.) </p>

<pre>
$ <b>cd /Users/cloyce/spec/cpu2017/v1.0.0</b>
$ <b>ls $SPEC/tools</b>
bin
$ 
$ <b>ls /Volumes/CPU2017v1.0.0/install_archives/*tar</b>
/Volumes/CPU2017v1.0.0/install_archives/tools-src.tar
$ <b>tar xf /Volumes/CPU2017v1.0.0/install_archives/tools-src.tar </b>
$ <b>ls tools/src</b>
Algorithm-Diff-1.1903    MailTools-2.14               XML-SAX-0.99           makedepf90-2.8.8
Exporter-Tiny-0.042      PDF-API2-2.025               XML-SAX-Base-1.08      ntzsh
File-NFSLock-1.27        SVG-2.64                     XML-SAX-ExpatXS-1.33   perl-5.24.0
Font-AFM-1.20            String-ShellQuote-1.04       XSLoader-0.22          redistributable
Font-TTF-1.05            Test-Deep-0.119              buildtools             rxp-1.5.0
IO-String-1.08           Text-CSV_XS-1.20             buildtools.bat         specinvoke
IO-stringy-2.111         TimeDate-2.30                buildtools.log         specsum
List-MoreUtils-0.416     URI-1.69                     expat-2.1.0            tar-1.28
MIME-tools-5.507         XML-NamespaceSupport-1.11    make-4.2.1             xz-5.2.2
$ 
</pre>


<p>The scripts <samp class="nb">$SPEC/tools/src/buildtools</samp>     (Unix) or <samp
class="nb">%SPEC%\tools\src\buildtools.bat</samp> (Windows) will build the tools.  You may need to invoke the
<samp>buildtools</samp> script with appropriate environment variables set first - see the sections immediately following that
provide notes about specific platforms.</p>

<p>You will need a C99 compiler.  Most of the tools are C++ or C89, but XZ is C99.</p>

<p>If everything goes right, you won't have to do very much at all, other than watch build commands fly by.  </p>


<h3 id="unix">2.a. Notes specific to Unix systems</h3>

<p>When building the tools under Unix, the following warnings appear to be harmless as of July 2011:</p>

   <ul>
   <li> Any message generated by a "make clean", especially the first time that you build, since there's nothing to
   clean!</li>

   <li> Warnings about missing 'makeinfo', 'alocal', 'automake', 'autoconf'.</li>
   </ul>

   <p><b>Check out those who have gone before.</b>  If the system for which you're attempting to build tools is similar to one
   for which a tools build exists, you may gain insight by looking at the top of the build logs in <samp
   class="nbsnugr">tools/src/buildtools.log</samp>.   Even if your system is very unusual and very different than previous
   systems, it is probably still worth your while to look over the previous logs.   You don't have to read all 20,000 lines;
   just check out the environment variables and path settings and so forth from the top of previous builds.</p>

   <p>For convenience, and to give you ideas as you may be thinking about some new system, here are the variables set by the
   builds from SPEC CPU 2017 v1.0.0 (lines have been wrapped for human readability).</p>

   <p class="snugbot"><b>aix-ppc-0.102.0.buildlog.txt</b></p>
<pre class="snugtop"> buildtools controls:
  SKIPPERLOPTIMIZE=1

 configure flags:
  PERLFLAGS=-Dcc=xlc_r -Duse64bitall -Dusethreads -Uuseshrplib -Uoptimize= -Aoptimize=-O2 
            -Aoptimize=-qarch=pwr4 -Aoptimize=-qtune=balanced:balanced -Accflags=-U__MATH__
  XZFLAGS=--enable-static --disable-shared
  ac_cv_func_realpath=no
  ac_cv_header_stdbool_h=yes

 build options:
  CC=xlc
  CFLAGS=-O3 -q64 -qsuppress=1500-036 -qlanglvl=extc99 -qarch=pwr4 -qtune=balanced:balanced
  CXX=xlC
  LDFLAGS=-b64
</pre>
<p class="snugbot"><b>hpux11iv3-ipf-0.101.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Doptimize=+O1 -Dlibpth=/usr/lib/hpux32 -Dldflags=-lm -Dcppstdin=cc 
            -Acppstdin=-E -Acppstdin=-Aa -Acppstdin=-D__STDC_EXT__ -Acppstdin=-AC89 
            -Aoptimize=-Ae -Aoptimize=+O2 -Aoptimize=+z -Aoptimize=-AC99

 build options:
  CFLAGS=-Ae +O2 +z -D_FILE_OFFSET_BITS=64 -AC99
  CXX=CC
  XZCFLAGS=-AC99
</pre>
<p class="snugbot"><b>linux-aarch64-0.904.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Uplibpth= -Aplibpth=/lib/aarch64-linux-gnu -Aplibpth=/lib 
            -Aplibpth=/usr/lib/aarch64-linux-gnu -Aplibpth=/usr/lib  -Uoptimize= -Aoptimize=-O3
  XZFLAGS=--disable-assembler

 build options:
  CC=gcc
  CFLAGS= -O3 
  CXX=g++
  LDFLAGS= 
</pre>
<p class="snugbot"><b>linux-armv7l-0.102.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Uplibpth= -Aplibpth=/lib/arm-linux-gnueabihf -Aplibpth=/lib 
            -Aplibpth=/usr/lib/arm-linux-gnueabihf -Aplibpth=/usr/lib  -Uoptimize= -Aoptimize=-O3
  XZFLAGS=--disable-assembler

 build options:
  CC=gcc
  CFLAGS= -O3 
  CXX=g++
  LDFLAGS= 

 make options:
  MAKEFLAGS=-j4
</pre>
<p class="snugbot"><b>linux-ppc-0.102.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Uplibpth= -Aplibpth=/lib/powerpc-linux-gnu -Aplibpth=/lib -Aplibpth=/usr/lib/powerpc-linux-gnu 
            -Aplibpth=/usr/lib  -Uoptimize= -Aoptimize=-m32 -Aoptimize=-O3 -Aoptimize=-m32
  XZFLAGS=--disable-assembler

 build options:
  CC=gcc
  CFLAGS=-m32 -O3 -m32 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
  CXX=g++
  LDFLAGS=-m32 -m32
</pre>
<p class="snugbot"><b>linux-ppc64-0.903.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Uplibpth= -Aplibpth=/usr/lib64 -Aplibpth=/usr/lib  -Uoptimize= -Aoptimize=-m64 
            -Aoptimize=-O3 -Aoptimize=-m64
  XZFLAGS=--disable-assembler

 build options:
  CC=gcc
  CFLAGS=-m64 -O3 -m64
  CXX=g++
  LDFLAGS=-m64 -m64
</pre>
<p class="snugbot"><b>linux-ppc64le-0.903.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Uplibpth= -Aplibpth=/usr/lib64 -Aplibpth=/usr/lib  -Uoptimize= -Aoptimize=-m64 
            -Aoptimize=-O3 -Aoptimize=-m64
  XZFLAGS=--disable-assembler

 build options:
  CC=gcc
  CFLAGS=-m64 -O3 -m64
  CXX=g++
  LDFLAGS=-m64 -m64
</pre>
<p class="snugbot"><b>linux-sparc-0.102.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Uplibpth= -Aplibpth=/lib64 -Aplibpth=/usr/lib64 -Aplibpth=/lib -Aplibpth=/usr/lib  
            -Uoptimize= -Aoptimize=-m64 -Aoptimize=-O3 -Aoptimize=-m64
  XZFLAGS=--disable-assembler

 build options:
  CC=gcc
  CFLAGS=-m64 -O3 -m64
  CXX=g++
  LDFLAGS=-m64 -m64
</pre>
<p class="snugbot"><b>linux-x86_64-0.102.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Uplibpth= -Aplibpth=/lib64 -Aplibpth=/usr/lib64 -Aplibpth=/lib 
            -Aplibpth=/usr/lib  -Uoptimize= -Aoptimize=-m64 -Aoptimize=-O3 -Aoptimize=-m64
  XZFLAGS=--disable-assembler

 build options:
  CC=gcc
  CFLAGS=-m64 -O3 -m64
  CXX=g++
  LDFLAGS=-m64 -m64
</pre>
<p class="snugbot"><b>macosx-x86-0.102.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Doptimize=-O3 -Aoptimize=-g -Aoptimize=-m64
  XZFLAGS=--disable-assembler

 build options:
  CC=cc
  CFLAGS=-m64
  CPPFLAGS=-no-cpp-precomp -D_DARWIN_C_SOURCE
  CXX=CC
  LDFLAGS=-m64
  SUMCFLAGS=-O3
</pre>
<p class="snugbot"><b>solaris-sparc-0.904.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  PERLFLAGS=-Doptimize=-xO4 -Aoptimize=-xchip=generic -Aoptimize=-xtarget=generic 
            -Aoptimize=-g -Dcc=cc -Dlibswanted=socket -Alibswanted=nsl -Alibswanted=dl 
            -Alibswanted=m -Aoptimize=-m64 -Aoptimize=-xpagesize=4M
  TARFLAGS=-with-rmt=/usr/sbin/rmt
  XZFLAGS=--disable-assembler

 build options:
  CC=cc
  CFLAGS=-m64 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -xpagesize=4M
  CXX=CC
  LDFLAGS=-m64
  SPECINVOKECFLAGS=-xc99
  SUMCFLAGS=-xO4 -xchip=generic -xtarget=generic
  XZCFLAGS=-fast -xchip=generic -xtarget=generic
</pre>
<p class="snugbot"><b>solaris-x86-0.102.0.buildlog.txt</b></p>
<pre class="snugtop">

 configure flags:
  PERLFLAGS=-Doptimize=-xO4 -Aoptimize=-xchip=generic -Aoptimize=-xtarget=generic 
            -Aoptimize=-g -Dcc=cc -Dlibswanted=socket -Alibswanted=nsl -Alibswanted=dl 
            -Alibswanted=m -Aoptimize=-m32 -Aoptimize=-xpagesize=2M
  TARFLAGS=-with-rmt=/usr/sbin/rmt
  XZFLAGS=--disable-assembler

 build options:
  CC=cc
  CFLAGS=-m32 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -xpagesize=2M
  CXX=CC
  LDFLAGS=-m32
  SPECINVOKECFLAGS=-xc99
  SUMCFLAGS=-xO4 -xchip=generic -xtarget=generic
  XZCFLAGS=-fast -xchip=generic -xtarget=generic
</pre>
<p class="snugbot"><b>tru64-alpha-0.903.0.buildlog.txt</b></p>
<pre class="snugtop">
 configure flags:
  XZFLAGS=ac_cv_prog_cc_c99=

 build options:
  SPECINVOKECFLAGS=-DHAVE_STDBOOL_H -I.
  SUMCFLAGS=-O4 -DPRIuMAX=\"llu\" -DPRIx64=\"llx\" -I/tmp/tmpinclude
  XZCFLAGS=-pthread -DPRIx64=\"llx\" -DPRIx32=\"x\"
</pre>



<h3 id="windows">2.b. Notes specific to Windows systems</h3>

<p>Because XZ is written in C99, no version of Visual Studio (as of July 2011) can be used to build the tools.  Instead,
the Windows version of buildtools is designed to use the MinGW GCC compiler.  It has been tested successfully with both 4.3 and
4.5 versions of GCC; the latest version available should be used.  The tools are not yet ported to be built with a 64-bit compiler;
use the 32-bit tools instead.</p>

<p>The builds use makefiles to be processed with either mingw-make.exe (which is GNU make) or dmake.exe (which is built in the
process of building tools).  The full MSYS environment is not used, so all of the makefiles are pre-generated; the GNU autoconf
system is not used.  Compiler flags are defined in those pre-generated makefiles.<br />
Building tools under Cygwin is not supported and probably won't work.</p>

<p>If it is necessary to unzip and untar the sources of the tools in Windows, open a Command-Prompt window, cd to
<samp>%SPEC%</samp> (i.e. the top directory of SPEC). Then execute:</p>

<pre>
  cd tools
  bin\windows-i386\specxz.exe -d install_archives/cpu2017.tar.xz
  ooo\windows-i386\spectar.exe -xvf install_archives/cpu2017.tar
</pre>

<p>Then go ahead and execute </p>

      <p class="l1ex">%SPEC%\tools\src\buildtools.bat </p>

<p>You can ignore warnings about objects that are not found, especially at the beginning of each tool build, when cleanup is
attempted from previous builds.  Some tools may not know how to make '<samp class="snuglr">clean</samp>', '<samp class="snuglr">distclean</samp>', or
'<samp class="snuglr">realclean</samp>'; don't worry about it.</p>

<p>In Windows XP with Service Pack 2 or later, there may be a Security Alert, depending on the Firewall settings. "Windows Firewall
has blocked this program from accepting connections from the Internet or a network." You may ignore this warning.</p>

<p>All compiler warnings seen as of July 2011 appear to be harmless.</p>

<h2 id="verify">3. How to verify that your build succeeded</h2>

<p>After a tool build, you should: </p>

<pre>
  cd $SPEC (Unix) or %SPEC% (Windows)

  shrc.bat (Windows)
  . ./shrc (Unix, if you are in an sh-compatible shell.  
                  If not, start one!)  

  See if you can at least get as far as asking the major tools
  to identify themselves:

       runcpu -V 

  Or you can ask individual tools about themselves:

       specmake -v 
       specxz -h
       specperl -v
       specdiff -h
       runcpu -h 
       specinvoke -h 

</pre>

<p>Running <samp class="nb">runcpu --test</samp> will run more comprehensive tests on specperl.</p>

<h2 id="describe">4. Describing your newly-built tools</h2>

<p>As a courtesy to others who might like to know which systems you intended your new tools to work on, and to describe the
environment in which they were built, you may write a short description file.  The contents of this file will be displayed
when <samp>install.sh</samp> is run.  Windows users only have one choice, and thus no description is printed.  The file is <samp
class="nbsnugr">$SPEC/tools/bin/&lt;archname&gt;/description</samp>.  If that directory does not exist, you should create it.  (If
the directory does not exist, <samp>packagetools</samp> will create it, but in order for the description to be packaged, it must
be present <span class="u">before</span> <samp>packagetools</samp> is run.)  See the <a href="#package">"Packagetools"</a> section
below for guidance about picking "<samp class="nbsnuglr">&lt;archname&gt;</samp>".</p>

<p>The format is very simple; in order to avoid wrapping on an 80-column screen, the first line must be no longer than 50
characters.  In order to line up properly, subsequent lines should begin with 30 spaces and be no longer than 80 columns
total.</p>

<p>For example, given <samp class="nb">$SPEC/tools/bin/turboblaster-m68k/description</samp> with
the following contents</p>

<pre>
For TurboBlaster v2.1+ systems running on M68010
                             hardware.
                             Built on TurboBlaster v2.0 with GCC 1.81.
</pre>

<p>A user using a TurboBlaster system when running install.sh would see in the list of toolset choices, something that looks
approximately like</p>

<pre>
turboblaster-m68k            For TurboBlaster v2.1+ systems running on M68010
                             hardware.
                             Built on TurboBlaster v2.0 with GCC 1.81.
</pre>

<p>There are plenty of examples on the install media in <samp class="nbsnugr">tools/bin/*/description</samp>.</p>

<h3 id="presentation">4.a. Toolset presentation</h3>

<p>If the toolset you're building isn't the only one that will work on a particular system, you may want to adjust where in the
list of toolsets it appears, or even whether it appears at all.  By default toolsets are presented in lexical ASCII order. However,
it is possible to both adjust the position of a toolset in the list of candidates, as well as keeping it from appearing at all.</p>

<p>Let's assume that the TurboBlaster systems mentioned in the <a href="#describe">last section</a> have migrated to PowerPC and
have an emulation layer so that they can run old M68K binaries.  Given two toolsets called
<samp class="nb">turboblaster-m68k</samp> and <samp class="nbsnugr">turboblaster-ppc</samp>, normally the
<samp class="nb">turboblaster-m68k</samp> would be presented and attempted first.  And the emulation layer is so good that it
would work, but it'd be slower than it needs to be.</p>

<h4 id="exclusion">4.a.1. Excluding otherwise valid candidates</h4>

<p>There are several files that can be used to prevent <samp class="nb">install.sh</samp> from even attempting to use a
toolset.  The exclusion is silent, and for all intents and purposes makes the affected toolset behave just as one from another OS
or architecture &mdash; it doesn't even show up on the candidate list.</p>

<p>To effect this exclusion, <samp class="nb">install.sh</samp> looks for signatures of the current system in files in each
toolset's directory.  A toolset is excluded from consideration if any of the following are true:</p>

<table>
<tr> <th>Output from...</th> <th>Appears in...</th> </tr>
<tr> <td><samp class="nb">uname -m</samp></td> <td><samp class="nb">tools/bin/&lt;archname&gt;/excludearch</samp></td> </tr>
<tr> <td><samp class="nb">uname -s</samp></td> <td><samp class="nb">tools/bin/&lt;archname&gt;/excludearch</samp></td> </tr>
<tr> <td><samp class="nb">uname -r</samp></td> <td><samp class="nb">tools/bin/&lt;archname&gt;/excluderev</samp></td> </tr>
<tr> <td><samp class="nb">uname -p</samp></td> <td><samp class="nb">tools/bin/&lt;archname&gt;/excludeproc</samp></td> </tr>
</table>

<p>On a PPC-based TurboBlaster system, <samp class="nb">uname -m</samp> returns "PowerPC".  Putting "PowerPC" into
<samp class="nb">tools/bin/turboblaster-m68k/excludearch</samp> would ensure that TurboBlaster/PPC users never even saw the
TurboBlaster/M68K tools.</p>

<p>This is most useful for preventing cross-OS confusion.  FreeBSD, for example, used to try to execute Solaris binaries.  Putting
"FreeBSD" (the output from <samp class="nb">uname -s</samp> on a FreeBSD system) into
<samp class="nb">tools/bin/solaris-x86/excludearch</samp> fixed that problem and kept the unmaskable and alarming failure
messages from appearing during installation.</p>

<h4 id="order">4.a.2. Affecting presentation order</h4>

<p>In the case where there may be two equally valid toolsets (as might be the case when there's a 32-bit and 64-bit build for the
same OS), it's possible to change the order in which they're presented.  Each toolset has a file named
<samp class="nb">order</samp> in its directory.  If it doesn't exist, <samp class="nb">packagetools</samp> will create this
file with contents that are simply:</p>

<pre>
1:&lt;archname&gt;
</pre>

<p>(See the <a href="#package">packagetools</a> section for guidelines on picking <samp class="nbsnugr">&lt;archname&gt;</samp>.)  The
"priority" of a toolset decreases as that number increases.  Continuing with the TurboBlaster example, if we wanted the PowerPC
toolset to be preferred, we'd put</p>

<pre>
2:turboblaster-m68k
</pre>

<p>into <samp class="nbsnugr">tools/bin/turboblaster-m68k/order</samp>.  That would ensure that
<samp class="nb">turboblaster-ppc</samp> would appear first in the menu, as the number in its <samp class="nb">order</samp>
file is "1".  Since it appears first in the menu, it's installed before <samp class="nbsnugr">turboblaster-m68k</samp>.</p>

<h2 id="package">5. Packagetools</h2>

<p>If everything has succeeded, and you intend to submit results using your new tools, you should submit the tools to SPEC.
To do so:</p>

<pre>
     cd $SPEC (Unix) or cd %SPEC% (Windows)
     packagetools &lt;archname&gt;
</pre>

<p>Pick an architecture name that other users will recognize.  Check on the install media in tools/bin for some examples.</p>

<p>The packagetools script will create: </p>
<pre>
    $SPEC/tools/bin/&lt;archname&gt;/specxz
    $SPEC/tools/bin/&lt;archname&gt;/spectar
    $SPEC/tools/bin/&lt;archname&gt;/specmd5sum
    $SPEC/tools/bin/&lt;archname&gt;/tools-&lt;archname&gt;.tar.xz
</pre>

<p>Having created a large tarfile with everything in it, <samp>packagetools</samp> will then proceed to create an even larger
tarfile with <samp>specxz</samp> and <samp>spectar</samp> it in too.  This even bigger file is known as:</p>

<pre>
    $SPEC/&lt;archname&gt;-&lt;version&gt;.tar
</pre>

<p>and is to be submitted to SPEC. (See also the example below.)</p>

<p>You can optionally add components to your platform's toolset.  For example, if you would like <samp
class="nb">$SPEC/config/default.cfg</samp> to be set in an appropriate way, you can add the relative path to default.cfg
as a parameter to packagetools:</p>

<pre>
(on non-Windows systems)
     cd $SPEC
     packagetools &lt;archname&gt; config/default.cfg
</pre>

<p>More than one file may be specified in this way.</p>

<p>Operation on Windows is substantially similar; just provide the relative paths with backslashes instead of forward slashes.</p>

<p>Please submit the resulting tarfile to SPEC for review, along with the recording of your tool build session.
SPEC will review your tools, and assuming that they pass review, will add the tools you have built to its patch library, for
possible distribution to future users of your interesting new architecture.</p>

<p>NOTE 1: If your operating system is unable to execute the packagetools script, please have a look at what the script does
and enter the corresponding commands by hand.  Again, you will need to submit the results to SPEC.</p>

<p>NOTE 2: Be sure to test your packaged tools on a different system, preferably one with a different disk layout.  If the
destination system is unable to invoke <samp>libperl.so,</samp> check that <samp>libperl.so</samp> exists in one of the locations
where <samp>shrc</samp> expects to find it.</p>

<h3 id="PackageExample">5.a. Example: use packagetools</h3>

<p>Here is an example use of <samp class="nbsnugr">packagetools</samp>.  In the example below, notice that:</p>
<ul>
<li>At lines 1-3, we start by verifying that the correct environment has been set.</li>
<li>At line 7, a description is provided for the toolset.</li>
<li>SPEC will want the log, and verification that 
<samp class="nb">runcpu -V</samp> and <samp class="nb">runcpu --test</samp> 
are working.  At lines 11 to 13, these are created.</li>
<li>At line 15, the <samp class="nb">packagetools</samp> command is entered.  Since SPEC will want the other three files,
for convenience, they have been added to packagetools. </li> 
<li><b>Note</b> that basic sanity checking of a toolset <a href="#PackageTestExample">also requires</a> demonstration of
<samp class="nb">runcpu -V</samp> and <samp class="nb">runcpu --test</samp> on a second system, as shown in the
next section.</li>
</ul>

<pre>
  1  $ <b>. ./shrc</b>
  2  $ <b>which runcpu</b>
  3  /spec/cpu2017/kit117/bin/runXXX
<br /><span class="alarm">XXX this example must be regenerated</span><br />
  4  $ 
  5  $ <b>export MYTOOLS=myOS-myHW</b>
  6  $ <b>mkdir tools/bin/$MYTOOLS</b>
  7  $ <b>echo \
  8     "For systems running myOS.  Note: works only with V12 or later" \
  9     tools/bin/$MYTOOLS/description</b>
 10  $ 
 11  $ <b>cp typescript $MYTOOLS.buildlog.txt</b>
 12  $ <b>runXXX -V &gt; $MYTOOLS.runXXX-V.txt 2&gt;&amp;1</b>
 13  $ <b>runXXX --test &gt; $MYTOOLS.runXXX--test.txt 2&gt;&amp;1</b>
 14  $ 
 15  $ <b>packagetools $MYTOOLS $MYTOOLS.buildlog.txt $MYTOOLS.runsp*txt </b>
 16  Preparing /spec/cpu2017/kit117/tools/bin/myOS-myHW
 17  Generating checksums for the tools
 18  Generating the tools installation tarball
 19   100 %         12.0 MiB / 80.1 MiB = 0.149   1.0 MiB/s       1:17             
 20  Making the distribution tarball
 21  tools/bin/myOS-myHW/
 22  tools/bin/myOS-myHW/order
 23  tools/bin/myOS-myHW/tools-myOS-myHW.tar.xz
 24  tools/bin/myOS-myHW/description
 25  tools/bin/myOS-myHW/unbundled
 26  tools/bin/myOS-myHW/specxz
 27  tools/bin/myOS-myHW/specmd5sum
 28  tools/bin/myOS-myHW/spectar
 29  
 30  *******************************************************************
 31  
 32  The tarball to submit for inclusion in the distribution is
 33  
 34  myOS-myHW-117.tar
 35  
 36  ABSOLUTELY DO NOT submit the tarball in tools/bin/myOS-myHW
 37  as it is not complete.
 38  
 39  *******************************************************************
 40
 41  $ <b>specmd5sum myOS-myHW-117.tar &gt; myOS-myHW-117.tar.md5</b>
</pre>


<h3 id="PackageTestExample">5.b. Example: test the newly packaged tools</h3>

<p>Testing a newly-built toolset on the system where it was built is not enough to ensure basic sanity of the tools.
Test for unintended dependencies by installing on an entirely different system. For example:</p>

<ul>
<li>At line 1, below, it is assumed that a SPEC CPU tree exists on the destination system, and that it lacks a SPEC
toolset.</li>
<li>Line 2 uses NFS (<samp class="nbsnuglr">/net</samp>) to copy the new tar file from the build system.  Use whatever method
is convenient for you, such as <samp class="nb">scp</samp> or <samp class="nbsnugr">ftp</samp>, provided that you are sure
that it does not damage the file.  </li>
<li>Lines 3 and 4 bring over the recently built <samp class="nb">spectar</samp> and <samp
class="nbsnugr">specmd5sum</samp>, which are used to verify that the copy worked correctly, and then to unpack the file.</li>
</ul>

<pre>
  1  $ <b>cd /spec/cpu2017</b>
  2  $ <b>cp /net/(buildsys)/spec/cpu2017/kit117/myOS-myHW-117.tar* .</b>
  3  $ <b>cp /net/(buildsys)/spec/cpu2017/kit117/bin/spectar .</b>
  4  $ <b>cp /net/(buildsys)/spec/cpu2017/kit117/bin/specmd5sum .</b>
  5  $ <b>ls</b>
  6  myOS-myHW-117.tar      myOS-myHW-117.tar.md5  specmd5sum             spectar
  7  $ <b>./specmd5sum -c myOS-myHW-117.tar.md5 </b>
  8  myOS-myHW-117.tar: OK
  9  $ <b>./spectar -xvf myOS-myHW-117.tar</b>
 10  tools/bin/myOS-myHW/
 11  tools/bin/myOS-myHW/spectar
 12  tools/bin/myOS-myHW/tools-myOS-myHW.tar.xz
 13  tools/bin/myOS-myHW/unbundled
 14  tools/bin/myOS-myHW/description
 15  tools/bin/myOS-myHW/specxz
 16  tools/bin/myOS-myHW/order
 17  tools/bin/myOS-myHW/specmd5sum
 18  $
</pre> 

<ul>
<li>Having unpacked the new tools, at line 19, <samp class="nb">install.sh -u</samp> is entered to request use of this
toolset, and to skip trying any other toolsets.</li>
<li>At lines 29 and 30, runcpu is verified on the new system.</li>
<li>A quick check at line 32 shows that the same number of tests passed on both the build system and the new system.</li>
<li>At line 36, the output of the new system's tests are packaged up so that they can also be provided to SPEC.</li>
</ul>

<pre>
 19  $ <b>install.sh -u myOS-myHW</b>
 20  .
 21  .
 22  .
 23  Installation successful.  Source the shrc or cshrc in
 24  /spec/cpu2017/kit117
 25  to set up your environment for the benchmark.
 26  
 27  
 28  $ <b>. ./shrc</b>
 29  $ <b>runXXX -V &gt; newsys.runXXX-V.txt 2&gt;&amp;1</b>
<br /><span class="alarm">XXX this example must be regenerated</span><br />
 30  $ <b>runXXX --test &gt; newsys.runXXX--test.txt 2>&amp;1</b>
 31  $
 32  $ <b>grep -c "...ok" *runXXX--test*</b>
 33  myOS-myHW.runXXX--test.txt:215
 34  newsys.runXXX--test.txt:215
 35  $                                                                     
 36  $ <b>spectar cvf - newsys.runXXX* | specxz > newsys.tests.tar.xz</b> 
</pre>

<h2 id="troubleshooting">6. Troubleshooting: What to do if something goes wrong</h2>

<p>If something goes wrong, unfortunately, you're probably just going to have to take it apart and figure out what.  Here are
some hints on how to go about doing that.</p>

<h3 id="hand">6.a. Try it by hand</h3>

<p>If something goes wrong, you probably do NOT want to make some random adjustment (like: reinstall a compiler, fix an
environment variable, or adjust your path) and start all over again.  That's going to be painful and take a lot of your time.
Instead, you should temporarily abandon the <samp>buildtools</samp> script at that point and just try to build the offending
tool, until you understand exactly why that particular tool is failing.</p>

<p>Consider turning on verbose diagnostics if your system has a way to do that.  Make a huge terminal window (e.g. 200
columns wide by 84 lines tall, with 9999 lines recorded off the top), so you can see what is going on.</p>

<p>Read what <samp>buildtools</samp> (or <samp class="snugr">buildtools.bat</samp>) does for you, then cd to <samp
class="nb">tools/src/&lt;tool&gt;</samp> and try the commands by hand. For example, you might do something like this:</p>
<pre>
    cd $SPEC/tools/src/&lt;toolname&gt;
    ./configure
    make (or build.sh or whatever you note buildtools would have done)
</pre>

<p>Now, try fixing that environment variable or reinstalling that compiler, and rebuild the single tool.  Does it look
better?</p>

<p>If not, have a close look at the error messages and the <samp class="snugr">Makefile</samp>.  Does the <samp>Makefile</samp> use a feature that
is not present in your version of <samp class="snugr">make</samp>?  If so, can you get it to work with <samp class="snugr">GNU make</samp>?  </p>


<p>Note that for GNU configure based tools (everything except Perl and its modules) you may specify your compiler by setting
the <samp>CC</samp> environment variable. For compiler flags, set <samp class="snugr">CFLAGS</samp>.</p>

<p>When building <samp class="snugr">perl</samp>, note that:</p>

<ul>
 <li> If you want to force the compiler use <samp class="nb">-Dcc=yourcompiler</samp></li>
 <li> If you want to force a compiler option use <samp class="nb">-Doptimize=youroption.</samp>  If you
   have more than one option to use, do

<pre>
       -Doptimize=-option1 -Aoptimize=-option2 -Aoptimize=option3 ...
</pre></li>
</ul>

<p>Many of the build logs in <samp class="nb">tools/src/buildtools.log</samp> have examples of
settings used for <samp class="snugr">PERLFLAGS</samp>.</p>

<p>If you want to see more about what buildtools is doing for you, turn on your shell's verbose mode.  For example:</p>
<pre>
   sh -x ./buildtools
</pre>

<h3 id="known">6.b. Known problems</h3>

<p>Try doing a web search to see if there are known problems with the tool on your architecture.</p>

<p>If SPEC supplies Version X.Y of a tool and it just won't build on your operating system, you might check whether there is
a new Version X.Y+1 available.  If so, download the new version to a scratch directory outside of the SPEC tree and try
building it there.  If that version succeeds, try to deduce why.  Narrow it down to a one-line fix, won't you please?  Then
tell SPEC that you'd like the same one-line fix applied to its variant of the tool.  Or, if you just can't narrow the fix
down, ask SPEC whether it will allow use of Version X.Y+1 instead of X.Y on your system.</p>

<h3 id="justpart">6.c. Executing just part of buildtools</h3>

<p>Once you believe that you understand how to fix the problem tool, and
can build it by hand, see whether the <samp>buildtools</samp> script can build it.
You can execute just a portion of <samp>buildtools</samp> by defining environment
variables.  Please read the script itself to see what variables are
allowed; the following are just some examples:</p>
<pre>
  SKIPALL      - turns off everything.  If you like, set this, then
                   turn individual phases on by setting them.
  DOTOOLSRM    - Remove previously installed tools
  DOCLEAN      - Run 'make clean', 'make distclean', and
                   'make realclean' in all source directories.
  DOMAKE       - build make
  DOXZ         - build xz
  DOTAR        - build tar
  DOSUM        - build specsha512sum, specsha256sum, and specmd5sum
  DOSPECINVOKE - build specinvoke
  DORXP        - build rxp
  DOEXPAT      - build the expat XML parser, used by XML::SAX::ExpatXS
  DOPERL       - build perl
  DOPERL2      - build perl modules
  DOCOPY       - copy the results to $SPEC/bin and fix shbangs
</pre>

<p>It doesn't matter what you set the environment variables to -- any non-zero-length string will do.  In all cases,
"<samp class="snuglr">DO</samp>" can be replaced with "<samp class="snuglr">SKIP</samp>" to reverse the sense of the setting.</p>

<p>If you are using Windows, be sure to note the <span class="alarm">WARNING</span> in <samp>buildtools.bat</samp> about how the
variables work.</p>

<p>If you can now build the (formerly misbehaving) tool using just part of <samp class="snugr">buildtools</samp>, then you can try building the
whole set (i.e. a build of all tools from start to finish).  It should work now, so be sure to <a href="#logit">turn on your
logging facility</a>.</p>

<h2 id="support">7. Support</h2>

<p>You'll find information about technical support in <samp class="snugr">techsupport.html</samp>, either in <a class="external"
href="techsupport.html"> the same directory</a> where you are found the document you are reading now, or <a class="external"
href="https://www.spec.org/cpu2017/Docs/techsupport.html">at www.spec.org/cpu2017</a>.</p> 


<p style="border-top:thin solid black;">
Building the SPEC CPU&reg;2017 Toolset:
Copyright&nbsp;&copy;&nbsp;2017-2019 Standard Performance Evaluation Corporation (SPEC&reg;)</p>
<!-- this space intentionally left blank: some empty space at the bottom increases the probability that clicking on a link in
   the table of contents will actually position the desired section at the top of your browser window -->
<p style="margin:300px 1em;">&nbsp;</p>



</body></html>
