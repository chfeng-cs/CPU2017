<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
      <link rel="STYLESHEET" href="https://www.spec.org/cpu2017/Docs/css/cpudocs.css" type="text/css" />
<title>502.gcc_r</title>
<meta name="generator" content="Cloyce+VIM 7.2" />
<meta name="revision"
      content="$Id: gcc.html 6320 2019-07-28 23:29:02Z JohnHenning $" />
</head>

<body>
<div style="text-align: center">
<h1>502.gcc_r<br />
SPEC CPU&reg;2017 Benchmark Description</h1>
</div>
 
<h3>Benchmark Name</h3>
<p>502.gcc_r</p>

<h3>Benchmark Author</h3>
<p>Richard Stallman and a large cast of helpers.<br />
   For a full list, see <a href="http://gcc.gnu.org/onlinedocs/gcc/Contributors.html">http://gcc.gnu.org/onlinedocs/gcc/Contributors.html</a></p>

<h3>Benchmark Program General Category</h3>
<p>C Language optimizing compiler</p>
 
<h3>Benchmark Description</h3>
<p>502.gcc_r is based on GCC Version 4.5.0.  It generates code for an IA32
   processor. The benchmark runs as a compiler with many of its optimization
   flags enabled.</p>

<p>502.gcc_r has altered inlining heuristics, so as to inline
   more code than may be typical of Unix systems as of the time that the
   porting work was done for the benchmark. This was done so that 502.gcc_r
   would spend more time analyzing its source code inputs, and use more
   memory. Without this effect, 502.gcc_r would have done less analysis, and
   needed more input workloads to achieve the run times required for CPU2017.  
   Recall that SPEC CPU&reg; benchmarks are drawn from 'the compute-intensive
   portion of real applications'; therefore, for the benchmark version, the 
   preference is to compile a few large files instead of many small files.</p>


<h3>Input Description</h3>
<p>The inputs to the benchmark are C source code files.  The large files for 
   the ref workloads are GCC itself, after preprocessing.  The presentation of 
   the entire (preprocessed) source set at one time avoids I/O and allows 
   the benchmark compiler a wide scope as it considers optimizations.  There are
   several optimizations used, which can be found in the file <tt>control</tt> in 
   each of the input directories.  For example, the brief 'test' workload uses<br />
   <tt>-O3 -finline-limit=50000</tt>.  </p>

<p>New inputs can be generated by writing C source code.</p>


<h3>Output Description</h3>
<p>All output files are IA32 assembly code files.</p>


<h3>Programming Language</h3>
<p>C</p>

<h3>Known Portability Issues
   <span id="Duplicate-symbols"> </span>   <span id="Portability"> </span>      <span id="Inline"> </span>
   <span id="Duplicate.symbols"> </span>   <span id="portability"> </span>      <span id="inline"> </span>
   <span id="DuplicateSymbols"> </span>    <span id="Porting"> </span>          <span id="Inlining"> </span>
   <span id="Duplicate_symbols"> </span>   <span id="porting"> </span>          <span id="inlining"> </span>
   <span id="Duplicatesymbols"> </span>
   <span id="duplicate-symbols"> </span>
   <span id="duplicate.symbols"> </span>
   <span id="duplicateSymbols"> </span>
   <span id="duplicate_symbols"> </span>
   <span id="duplicatesymbols"> </span>
</h3>

<p><b>[1] Aliasing</b>: The <tt>spec_qsort.c</tt> routine does not strictly obey the ANSI aliasing rules.  You may need to add your
compiler's switch that reduces optimization accordingly.  For example, with GCC, you may need to say:</p>
<pre style="margin:.2em 2em;">intrate,intspeed=base:
   EXTRA_COPTIMIZE = -fno-strict-aliasing</pre>
<p style="margin:.2em 0em;">Note in the above, as required by the <a
   href="https://www.spec.org/cpu2017/Docs/runrules.html#BaseFlags">rules</a>, the flag is set for all benchmarks in base.
For peak, you can be more selective.</p>

<p>For more information about <tt>spec_qsort.c</tt>, see the discussion in the documentation for <a
   href="https://www.spec.org/cpu2017/Docs/benchmarks/505.mcf_r.html#Portability">505.mcf_r</a>.</p>

<p><b>[2] Multiple definitions</b>: When using the GNU Compiler Collection (GCC) to compile the gcc benchmark, you may
encounter errors such as the following:</p> 
<pre>
   cc1-checksum.o: In function `vprintf':
   /usr/include/bits/stdio.h:38: multiple definition of `vprintf'
   main.o:/usr/include/bits/stdio.h:38: first defined here
</pre>
<p>Notice in the message above that the compiler appears to be objecting to using a definition at 
<br /><tt>stdio.h:38</tt> because it already has a definition at 
<br /><tt>stdio.h:38</tt>.  
<br />That somewhat confusing error signature is due to inclusion of header files
that use pre-1999 inlining keywords.  See the documentation of
<tt>-fgnu89-inline</tt> in the GNU chapter on <a
href="https://gcc.gnu.org/onlinedocs/gcc/C-Dialect-Options.html#index-fgnu89-inline">C-Dialect-Options</a>,
and the <a
href="https://gcc.gnu.org/onlinedocs/gcc/Inline.html#Inline">associated
discussion</a> of inlining, which explains how the keywords <tt>inline</tt>,
<tt>static</tt>, and <tt>extern</tt> were standardized in a manner that differs
from their pre-1999 use by GCC.  </p>

<p style="margin-bottom:.2em;">A recommended solution to this problem is:</p>

<pre style="margin.2em 2em;">intrate,intspeed=base:
   EXTRA_COPTIMIZE = -fgnu89-inline</pre>

         <p style="margin-top:.2em;">Note: as shown above, you would set the flag for all benchmarks,
         as required by the <a href="https://www.spec.org/cpu2017/Docs/runrules.html#BaseFlags">rules</a>.
         <br />In peak, if you wish, you could be more selective and set it only for the gcc benchmark.</p>


<p style="margin-bottom:.2em;"><b>Possible alternatives:</b></p>
<ul style="margin:.2em 1em;">
   <li>The switch <tt style="white-space:nowrap;">-z muldefs</tt> may be an alternative to 
      <tt style="white-space:nowrap;">-fgnu89-inline</tt>, and has the advantage of directly and simply reassuring 
      the linker that (for example), yes the routine at <br /><tt>stdio.h:38</tt> happens to be identical to the routine at 
      <br /><tt>stdio.h:38</tt>.  
      <br />Unfortunately, this solution is unlikely to work with 
      <tt style="white-space:nowrap;">-flto</tt> nor with <tt style="white-space:nowrap;">-m32</tt>.
      If you try it, 
      <a href="https://www.spec.org/cpu2017/Docs/runrules.html#BaseFlags"> set it for all benchmarks</a> in base.
   </li>

   <li> You could try using <tt>-std=gnuNN</tt>, provided that you 
      <a href="https://www.spec.org/cpu2017/Docs/runrules.html#BaseFlags"> set it for all benchmarks</a> in base; however,
      this is not tested and might or might not cause problems with other benchmarks.  (Note: using <tt>std=gnuXX</tt> as a
      "Portability" flag is not likely to be approved by SPEC, because <a
         href="https://www.spec.org/cpu2017/Docs/runrules.html#portability">the&nbsp;portabilty&nbsp;rule</a> considers
      degree of impact.  Setting a GNU-specific dialect as a portablility flag is not required given that more narrow
      solutions are available.) </li>
   </ul>

<h3>Other Portability Considerations</h3>

<ol>
   <li>Some of the optimizations 502.gcc_r performs require constant
   propagation of floating point constants. These form an insignificant
   amount of computation time, yet may depend on IEEE floating point
   format to produce a correct result.</li>
   <li>502.gcc_r is not an ANSI C program. It uses GNU extensions.</li>
   <li>The initial port of 502.gcc_r was to a 64 bit system. It has been
   successfully ported by SPEC to many 32-bit UNIX implementations.</li>
</ol>


<h3 id="license">Sources and Licensing</h3>

<p>502.gcc_r is based on the GNU C compiler version 4.5, using the GNU GPL license.  </p>

  <p>Please see details in the document <a
    href="https://www.spec.org/cpu2017/Docs/licenses.html#bmk502.gcc_r">SPEC CPU&reg;2017 Licenses</a>.</p>


<h3>References</h3>
<ul>
   <li>See the <a href="http://gcc.gnu.org">GCC home page</a></li>
</ul>

<p>Last updated: $Date: 2019-07-28 19:29:02 -0400 (Sun, 28 Jul 2019) $</p>
<p style="border-top:thin solid black;">
Copyright&nbsp;&copy;&nbsp;2017-2019 Standard Performance Evaluation Corporation (SPEC&reg;)</p>
</body>
</html>
